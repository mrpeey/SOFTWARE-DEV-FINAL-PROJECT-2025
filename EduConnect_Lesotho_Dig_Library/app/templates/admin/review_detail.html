{% extends "base.html" %}

{% block title %}Review Details - Admin - {{ library_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-6 mb-2">
                <i class="fas fa-star me-2"></i>Review Details
            </h1>
            <a href="{{ url_for('admin.manage_reviews') }}" class="btn btn-secondary mb-3">Back to Reviews</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            {% if review.book.cover_image %}
                                {% if review.book.cover_image.endswith('.svg') and review.book.svg_content %}
                                    <div class="img-fluid rounded shadow-sm mb-3">{{ review.book.svg_content|safe }}</div>
                                {% else %}
                                    <img src="{{ url_for('static', filename=review.book.cover_image) }}" alt="{{ review.book.title }}" class="img-fluid rounded shadow-sm mb-3">
                                {% endif %}
                            {% else %}
                                {% include 'shared/book_cover_svg.html' with context %}
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <h5 class="card-title">Book: {{ review.book.title }}</h5>
                            <!-- ...existing code... -->
                        </div>
                    </div>
                    <div class="mt-2 mb-3">
                        <button type="button" class="btn btn-info" id="shareBtn" data-bs-toggle="modal" data-bs-target="#shareModal">
                            <i class="fas fa-share-alt me-1"></i>Share
                        </button>
                    </div>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="shareModalLabel">Share this Book</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Share this book using:</p>
                <div class="d-flex flex-column gap-2">
                    <a id="shareEmail" class="btn btn-outline-primary" target="_blank"><i class="fas fa-envelope me-1"></i>Email</a>
                    <a id="shareWhatsApp" class="btn btn-outline-success" target="_blank"><i class="fab fa-whatsapp me-1"></i>WhatsApp</a>
                    <a id="shareFacebook" class="btn btn-outline-info" target="_blank"><i class="fab fa-facebook me-1"></i>Facebook</a>
                    <a id="shareCopy" class="btn btn-outline-secondary"><i class="fas fa-link me-1"></i>Copy Link</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var bookUrl = window.location.href;
    var bookTitle = document.querySelector('h2').innerText;
    document.getElementById('shareEmail').href = `mailto:?subject=Check out this book: ${bookTitle}&body=View it here: ${bookUrl}`;
    document.getElementById('shareWhatsApp').href = `https://wa.me/?text=Check out this book: ${bookTitle} - ${bookUrl}`;
    document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(bookUrl)}`;
    document.getElementById('shareCopy').onclick = function() {
        navigator.clipboard.writeText(bookUrl);
        this.innerText = 'Copied!';
        setTimeout(() => { this.innerHTML = '<i class="fas fa-link me-1"></i>Copy Link'; }, 1500);
    };
});
</script>
                    <h6 class="card-subtitle mb-2 text-muted">User: {{ review.user.get_full_name() if review.user else 'Unknown' }}</h6>
                    <div class="mb-2">
                        <strong>Rating:</strong>
                        <span class="text-warning">{{ '★' * review.rating }}{{ '☆' * (5-review.rating) }}</span>
                    </div>
                    <div class="mb-2">
                        <strong>Date:</strong> {{ review.created_at.strftime('%b %d, %Y %I:%M %p') }}
                    </div>
                    <div class="mb-2">
                        <strong>Status:</strong>
                        {% if review.is_approved %}
                            <span class="badge bg-success">Approved</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </div>
                    <div class="mb-2">
                        <strong>Review Text:</strong>
                        <p class="mt-2">{{ review.review_text }}</p>
                    </div>
                    <div class="mt-3">
                            {% if not review.is_approved %}
                            <form method="post" action="{{ url_for('admin.approve_review', review_id=review.id) }}">
                                {{ form.csrf_token }}
                                <button type="submit" class="btn btn-success">Approve Review</button>
                            </form>
                            {% endif %}
                            <form method="post" action="{{ url_for('admin.delete_review', review_id=review.id) }}" onsubmit="return confirm('Are you sure you want to delete this review?');">
                                {{ form.csrf_token }}
                                <button type="submit" class="btn btn-danger">Delete Review</button>
                            </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var bookUrl = window.location.origin + '/book/' + "{{ review.book.id }}";
    var bookTitle = "{{ review.book.title|e|escapejs }}";
    document.getElementById('shareEmail').href = `mailto:?subject=Check out this book: ${bookTitle}&body=View it here: ${bookUrl}`;
    document.getElementById('shareWhatsApp').href = `https://wa.me/?text=Check out this book: ${bookTitle} - ${bookUrl}`;
    document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(bookUrl)}`;
    document.getElementById('shareCopy').onclick = function() {
        navigator.clipboard.writeText(bookUrl);
        this.innerText = 'Copied!';
        setTimeout(() => { this.innerHTML = '<i class="fas fa-link me-1"></i>Copy Link'; }, 1500);
    };
});
</script>
{% endblock %}

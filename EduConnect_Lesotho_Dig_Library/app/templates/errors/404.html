{% extends "base.html" %}

{% block title %}Page Not Found - {{ library_name }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 text-center">
        <div class="mb-5">
            <i class="fas fa-book-dead fa-5x text-muted mb-4"></i>
            <h1 class="display-4 text-muted">404</h1>
            <h2 class="mb-4">Page Not Found</h2>
            <p class="lead mb-4">
                Sorry, the page you're looking for doesn't exist in our library catalog.
                It might have been moved, deleted, or you entered the wrong URL.
            </p>
            
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                    <i class="fas fa-home"></i> Go Home
                </a>
                <a href="{{ url_for('main.search') }}" class="btn btn-outline-primary">
                    <i class="fas fa-search"></i> Search Books
                </a>
                <a href="{{ url_for('main.categories') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-tags"></i> Browse Categories
                </a>
            </div>
        </div>
        
        <!-- Popular books suggestion -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-lightbulb text-warning"></i>
                    Maybe you're looking for these?
                </h5>
                <p class="card-text">Here are some popular resources from our library:</p>
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <a href="{{ url_for('main.search', q='digital literacy') }}" class="btn btn-outline-info btn-sm">
                        Digital Literacy
                    </a>
                    <a href="{{ url_for('main.search', q='academic') }}" class="btn btn-outline-info btn-sm">
                        Academic Resources
                    </a>
                    <a href="{{ url_for('main.search', q='local') }}" class="btn btn-outline-info btn-sm">
                        Local Literature
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- AI Chat UI removed -->
    <button class="btn btn-success btn-lg rounded-circle shadow" style="width:64px; height:64px;" onclick="openAIChatModal()">
        <i class="fas fa-robot fa-lg"></i>
    </button>
</div>
<div class="modal fade" id="aiChatModal" tabindex="-1" aria-labelledby="aiChatModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="aiChatModalLabel"><i class="fas fa-robot me-2"></i>Library AI Assistant</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" style="background: #f8f9fa;">
                <div id="ai-chat-window" style="height:350px; overflow-y:auto; padding:24px; background: #f8f9fa;"></div>
            </div>
            <div class="modal-footer bg-light">
                <form id="ai-chat-form" class="w-100 d-flex gap-2" autocomplete="off" onsubmit="sendAIMessage(event)">
                    <input type="text" id="ai-chat-input" class="form-control" placeholder="Ask me anything about the library..." required style="flex:1;">
                    <button type="submit" class="btn btn-success"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
function openAIChatModal() {
    const modal = new bootstrap.Modal(document.getElementById('aiChatModal'));
    modal.show();
    setTimeout(() => {
        document.getElementById('ai-chat-input').focus();
    }, 400);
}
function appendAIMessage(message, sender = 'ai') {
    const chatWindow = document.getElementById('ai-chat-window');
    const msgDiv = document.createElement('div');
    msgDiv.className = `ai-chat-message ${sender}`;
    msgDiv.innerHTML = `
        <div class="ai-chat-avatar">${sender === 'ai' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>'}</div>
        <div class="ai-chat-bubble">${message}</div>
    `;
    chatWindow.appendChild(msgDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}
function sendAIMessage(e) {
    e.preventDefault();
    const input = document.getElementById('ai-chat-input');
    const userMsg = input.value.trim();
    if (!userMsg) return;
    appendAIMessage(userMsg, 'user');
    input.value = '';
    appendAIMessage('<span class="spinner-border spinner-border-sm"></span> Thinking...', 'ai');
    fetch('/api/ai_chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': (document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '')
        },
        body: JSON.stringify({ message: userMsg })
    })
    .then(response => response.json())
    .then(data => {
        const chatWindow = document.getElementById('ai-chat-window');
        const lastMsg = chatWindow.querySelector('.ai-chat-message.ai:last-child .ai-chat-bubble');
        if (lastMsg) lastMsg.innerHTML = data.reply || 'Sorry, I could not process your request.';
        chatWindow.scrollTop = chatWindow.scrollHeight;
    })
    .catch(() => {
        const chatWindow = document.getElementById('ai-chat-window');
        const lastMsg = chatWindow.querySelector('.ai-chat-message.ai:last-child .ai-chat-bubble');
        if (lastMsg) lastMsg.innerHTML = 'Sorry, there was an error connecting to the AI.';
    });
}
document.addEventListener('DOMContentLoaded', function() {
    appendAIMessage('ðŸ‘‹ Hello! I am your Library AI Assistant. Ask me anything about books, borrowing, library services, or get recommendations.');
});
</script>
<style>
#ai-chat-fab .btn {
    box-shadow: 0 4px 16px rgba(25, 135, 84, 0.2);
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(25,135,84,0.4); }
    70% { box-shadow: 0 0 0 16px rgba(25,135,84,0); }
    100% { box-shadow: 0 0 0 0 rgba(25,135,84,0); }
}
#aiChatModal .modal-content {
    border-radius: 1rem;
    box-shadow: 0 8px 32px rgba(25,135,84,0.15);
}
#ai-chat-window {
    font-size: 1rem;
    background: #f8f9fa;
}
.ai-chat-message {
    margin-bottom: 1.2rem;
    display: flex;
    align-items: flex-start;
}
.ai-chat-message.user .ai-chat-bubble {
    background: #198754;
    color: #fff;
    align-self: flex-end;
}
.ai-chat-message.ai .ai-chat-bubble {
    background: #fff;
    color: #145c32;
    border: 1px solid #198754;
}
.ai-chat-bubble {
    padding: 0.75rem 1.2rem;
    border-radius: 1.2rem;
    max-width: 70%;
    box-shadow: 0 2px 8px rgba(25,135,84,0.07);
}
.ai-chat-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #198754;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    margin-right: 0.7rem;
}
.ai-chat-message.user .ai-chat-avatar {
    background: #145c32;
}
</style>
{% endblock %}